<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel de Registros - Mensualidades</title>

  <!-- Fuente moderna -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <!-- Estilos del Panel -->
  <link rel="stylesheet" href="panel-registros.css" />
</head>
<body>
  <!-- Pantalla de carga -->
  <div id="loadingScreen" class="loading-screen">
      <div class="loading-content">
          <img src="https://cdn.shopify.com/s/files/1/0763/5392/9451/files/03_TEOTIHUACAN_-_Fuerzas_Basicas.png?v=1749841591" alt="Teotihuac√°n Logo" class="loading-logo">
          <div class="loading-spinner"></div>
          <h3 class="loading-text">Cargando registros...</h3>
          <p class="loading-subtext">Por favor espera un momento</p>
      </div>
  </div>

  <!-- HEADER -->
  <header class="header">
    <div class="header-left">
      <img
        src="https://cdn.shopify.com/s/files/1/0763/5392/9451/files/03_TEOTIHUACAN_-_Fuerzas_Basicas.png?v=1749841591"
        alt="Logo Teotihuac√°n"
        class="logo"
      />
      <h1 class="header-title">Panel de Registros</h1>
    </div>
    <div class="header-buttons">
      <button id="updateNotificationBtn" class="header-btn update-btn hidden" title="Actualizar datos">
        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
        </svg>
        <span class="btn-text">Actualizar</span>
      </button>
      <button id="btnExportarPDF" class="header-btn export-btn" title="Exportar a PDF">
        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="12" y1="18" x2="12" y2="12"/>
          <line x1="9" y1="15" x2="15" y2="15"/>
        </svg>
        <span class="btn-text">Exportar PDF</span>
      </button>
    </div>
  </header>

  <!-- Indicador de estado Firebase -->
  <div id="firebaseStatus" class="firebase-status">
    <svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"/>
      <path d="M12 6v6l4 2"/>
    </svg>
    <span>Conectando a Firebase...</span>
  </div>

  <!-- CONTENIDO -->
  <main class="registros-container">
    <!-- Resumen estad√≠stico -->
    <div class="registros-summary">
      <div class="summary-card total">
        <div class="summary-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10 9 9 9 8 9"/>
          </svg>
        </div>
        <div class="summary-info">
          <div class="summary-number" id="totalRegistros">0</div>
          <div class="summary-label">Total Registros</div>
        </div>
      </div>
      <div class="summary-card efectivo">
        <div class="summary-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="5" width="20" height="14" rx="2"/>
            <line x1="2" y1="10" x2="22" y2="10"/>
          </svg>
        </div>
        <div class="summary-info">
          <div class="summary-number" id="totalEfectivo">$0</div>
          <div class="summary-label">Total en Efectivo</div>
        </div>
      </div>
      <div class="summary-card transferencias">
        <div class="summary-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="16"/>
            <line x1="8" y1="12" x2="16" y2="12"/>
          </svg>
        </div>
        <div class="summary-info">
          <div class="summary-number" id="totalTransferencias">$0</div>
          <div class="summary-label">Total Transferencias</div>
        </div>
      </div>
      <div class="summary-card pendientes">
        <div class="summary-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
        </div>
        <div class="summary-info">
          <div class="summary-number" id="totalPendientes">0</div>
          <div class="summary-label">Pendientes</div>
        </div>
      </div>
    </div>

    <!-- Controles de filtrado -->
    <div class="registros-controls">
      <!-- Primera fila: B√∫squeda y filtros principales -->
      <div class="filtros-grid">
        <div class="rc-input-wrap">
          <svg class="rc-input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input
            type="text"
            id="buscadorRegistros"
            placeholder="Buscar por nombre o folio..."
          />
        </div>
        
        <div class="rc-select-wrap">
          <select id="filtroCategoria">
            <option value="">Todas las categor√≠as</option>
            <option value="Alebrijes TDP">Alebrijes TDP</option>
            <option value="Soles TDP">Soles TDP</option>
            <option value="Sub-18">Sub-18</option>
            <option value="Sub-16">Sub-16</option>
            <option value="Sub-14">Sub-14</option>
          </select>
        </div>

        <div class="rc-select-wrap">
          <select id="filtroTipoPago">
            <option value="">Todos los tipos</option>
            <option value="Efectivo">Efectivo</option>
            <option value="Transferencia">Transferencia</option>
            <option value="Otro">Otro</option>
          </select>
        </div>

        <div class="rc-select-wrap">
          <select id="filtroConcepto">
            <option value="">Todos los conceptos</option>
            <option value="Mensualidad">Mensualidad</option>
            <option value="Registro TDP">Registro TDP</option>
            <option value="Registro Fuerzas B√°sicas">Registro Fuerzas B√°sicas</option>
            <option value="Otro">Otro</option>
          </select>
        </div>
      </div>

      <!-- Segunda fila: Fechas y bot√≥n limpiar -->
      <div class="filtros-fecha-row">
        <div class="rc-date-wrap">
          <label>Desde:</label>
          <input type="date" id="fechaDesde" />
        </div>

        <div class="rc-date-wrap">
          <label>Hasta:</label>
          <input type="date" id="fechaHasta" />
        </div>

        <button class="btn-limpiar" id="btnLimpiarFiltros">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="1 4 1 10 7 10"/>
            <polyline points="23 20 23 14 17 14"/>
            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
          </svg>
          <span>Limpiar Filtros</span>
        </button>
      </div>
    </div>

    <p class="registros-count" id="registrosCount"></p>

    <!-- Tabla de registros -->
    <div class="tabla-container">
      <table class="tabla-registros">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Nombre</th>
            <th>Categor√≠a</th>
            <th>Concepto</th>
            <th>Monto</th>
            <th>Tipo Pago</th>
            <th>Folio</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="registrosTabla">
          <tr>
            <td colspan="9" class="no-registros">Cargando registros...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <!-- MODAL DETALLE -->
  <div id="registroModal" class="registro-modal" aria-hidden="true">
    <div class="registro-modal-backdrop" data-close="true"></div>
    <div class="registro-modal-card">
      <button class="registro-modal-close" data-close="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
      
      <div class="registro-modal-header">
        <h3 id="registroModalTitulo">Detalle del Registro</h3>
        <div class="estado-badge-container">
          <span class="estado-badge" id="registroEstadoBadge">Pendiente</span>
        </div>
      </div>

      <!-- Tabs -->
      <div class="registro-tabs">
        <button class="registro-tab-btn active" data-tab="datos">
          <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
          </svg>
          <span>Datos</span>
        </button>
        <button class="registro-tab-btn" data-tab="comprobante">
          <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
          </svg>
          <span>Comprobante</span>
        </button>
      </div>

      <!-- Contenidos -->
      <div class="registro-tab-content active" id="tab-datos">
        <div class="datos-grid" id="registroDatosGrid">
          <!-- Se llena din√°micamente -->
        </div>
      </div>

      <div class="registro-tab-content" id="tab-comprobante">
        <div class="comprobante-info" id="comprobanteInfo">
          <!-- Se llena din√°micamente -->
        </div>
      </div>

      <!-- Footer con acciones -->
      <div class="registro-modal-footer">
        <button class="btn-accion aprobar" id="btnAprobar">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          <span>Aprobar</span>
        </button>
        <button class="btn-accion rechazar" id="btnRechazar">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
          <span>Rechazar</span>
        </button>
        <button class="btn-accion eliminar" id="btnEliminar">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"/>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            <line x1="10" y1="11" x2="10" y2="17"/>
            <line x1="14" y1="11" x2="14" y2="17"/>
          </svg>
          <span>Eliminar</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Firebase Configuration -->
  <script type="module">
    // Import Firebase functions
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
    import { 
      getFirestore, 
      collection, 
      getDocs, 
      doc, 
      updateDoc, 
      deleteDoc, 
      onSnapshot, 
      query, 
      orderBy 
    } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAD1solmKDUU_3e3-X5smMPZ18dsdeXdZU",
      authDomain: "paneldecontrolmensualidades.firebaseapp.com",
      projectId: "paneldecontrolmensualidades",
      storageBucket: "paneldecontrolmensualidades.firebasestorage.app",
      messagingSenderId: "941696609123",
      appId: "1:941696609123:web:23d1feb29cebbf4e0cc156"
    };

    console.log('üî• Inicializando Firebase...');

    try {
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      console.log('‚úÖ Firebase inicializado correctamente');

      // Make Firebase available globally
      window.firebaseApp = app;
      window.firebaseDB = db;
      window.firebaseCollection = collection;
      window.firebaseGetDocs = getDocs;
      window.firebaseDoc = doc;
      window.firebaseUpdateDoc = updateDoc;
      window.firebaseDeleteDoc = deleteDoc;
      window.firebaseOnSnapshot = onSnapshot;
      window.firebaseQuery = query;
      window.firebaseOrderBy = orderBy;

      // Dispatch event to notify that Firebase is ready
      window.dispatchEvent(new Event('firebaseReady'));

      // Update connection status
      const statusEl = document.getElementById('firebaseStatus');
      statusEl.innerHTML = `
        <svg class="status-icon success" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20 6 9 17 4 12"/>
        </svg>
        <span>Conectado a Firebase</span>
      `;
      statusEl.classList.add('success');
      
      console.log('üì° Estado de conexi√≥n actualizado');
      
      setTimeout(() => {
        statusEl.style.display = 'none';
      }, 3000);

    } catch (error) {
      console.error('‚ùå Error Firebase:', error);
      const statusEl = document.getElementById('firebaseStatus');
      statusEl.innerHTML = `
        <svg class="status-icon error" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="15" y1="9" x2="9" y2="15"/>
          <line x1="9" y1="9" x2="15" y2="15"/>
        </svg>
        <span>Error de conexi√≥n: ${error.message}</span>
      `;
      statusEl.classList.add('error');
    }
  </script>

  <!-- Main Script -->
  <script src="panel-registros.js"></script>
</body>
</html>